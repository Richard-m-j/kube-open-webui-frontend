# .github/workflows/dast.yml

name: DAST - Dynamic Security Scan

on:
  workflow_run:
    workflows: ["CI & CD Pipeline"]
    types:
      - completed

jobs:
  zap-baseline-scan:
    # Only run this job if the deployment workflow was successful
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    name: Scan live application with OWASP ZAP

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          ref: 'main'

      - name: ZAP Baseline Scan
        uses: zaproxy/action-baseline@v0.12.0
        with:
          # The public URL of your application running on EC2
          target: 'http://${{ secrets.EC2_PUBLIC_IP }}:30007'
          
          # Creates a downloadable HTML report of the scan results
          artifact_name: 'zap-scan-report'

          docker_options: '--user $(id -u)'