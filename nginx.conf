server {
    listen 80;
    server_name localhost;
    # Set the default root for the server
    root /usr/share/nginx/html;

    include /etc/nginx/mime.types;

    # API PROXY
    # This remains the same, proxying API calls to the backend.
    location /modelmanager/api/ {
        rewrite ^/modelmanager(/api/.*)$ $1 break;
        proxy_pass http://backend:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # --- THIS IS THE FIX ---
    # VUE APP
    # This block now correctly serves your app from the /modelmanager subpath.
    location /modelmanager/ {
        # 1. Try to find the exact file requested ($uri).
        # 2. If it's a directory, look for an index file ($uri/).
        # 3. If neither is found, serve the main index.html file to handle client-side routing.
        #    The path is /modelmanager/index.html because your Vite base is set to /modelmanager/.
        try_files $uri $uri/ /modelmanager/index.html;
    }

    # Health check endpoint
    location = / {
        return 200 'OK';
        add_header Content-Type text/plain;
    }
}